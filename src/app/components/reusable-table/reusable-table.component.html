<mat-card style="margin: 0">
  <table
    mat-table
    [dataSource]="dataSource"
    matSort
    [matSortActive]="sortBy"
    [matSortDirection]="sortOrder"
    (matSortChange)="onSortChange($event)"
  >
    <!-- Dynamic Columns -->
    <ng-container *ngFor="let column of columns" [matColumnDef]="column.key">
      <th
        mat-header-cell
        *matHeaderCellDef
        [mat-sort-header]="column.sortable !== false ? column.key : ''"
      >
        {{ column.header }}
      </th>
      <td mat-cell *matCellDef="let row">
        <!-- Custom Template -->
        <ng-container *ngIf="column.customTemplate && templates[column.customTemplate]">
          <ng-container
            *ngTemplateOutlet="
              templates[column.customTemplate];
              context: { $implicit: row, column: column }
            "
          >
          </ng-container>
        </ng-container>
        <!-- Default Template -->
        <ng-container *ngIf="!column.customTemplate">
          {{ row[column.key] }}
        </ng-container>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>

  <mat-paginator
    *ngIf="showPagination"
    [length]="totalItems"
    [pageSize]="pageSize"
    [pageIndex]="currentPage"
    [pageSizeOptions]="pageSizeOptions"
    (page)="onPageChange($event)"
  >
  </mat-paginator>
</mat-card>
